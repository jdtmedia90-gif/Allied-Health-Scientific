<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allied Health Scientific â€“ Online Shop</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f8fb; margin:0; padding:0; }
header { background:#040B80; color:white; padding:20px; text-align:center; }
header h1 { margin:0; }
.toolbar a { color:white; margin:0 10px; text-decoration:none; }
#product-list { display:flex; flex-wrap:wrap; padding:20px; gap:20px; justify-content:center; }
.product { background:white; padding:15px; border-radius:8px; width:200px; box-shadow:0 0 10px rgba(0,0,0,0.1); text-align:center; }
.product img { max-width:100%; cursor:pointer; }
.qty-box { margin:10px 0; }
#cart-panel { position:fixed; top:0; right:-400px; width:400px; height:100%; background:white; box-shadow:-3px 0 15px rgba(0,0,0,0.2); transition:0.3s; padding:20px; overflow-y:auto; }
#cart-panel.open { right:0; }
.cart-item { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.cart-item img { width:50px; height:50px; object-fit:cover; }
.actions input { width:50px; }
button { padding:10px 15px; background:#00B8E9; color:white; border:none; border-radius:6px; cursor:pointer; }
button:hover { background:#040B80; }
#status { margin-top:10px; font-weight:bold; text-align:center; color:#040B80; }
</style>
</head>
<body>
<header>
<h1>Allied Health Scientific</h1>
<button id="cart-btn">Cart (<span id="cart-count">0</span>)</button>
</header>

<main>
<div id="product-list"></div>
</main>

<div id="cart-panel">
<button id="close-cart">Close</button>
<h2>Your Cart</h2>
<div id="cart-items"></div>
<p>Subtotal: $<span id="cart-subtotal">0.00</span></p>

<form id="checkoutForm">
<input type="hidden" name="cartData" id="cartData">
<label>Name</label><input type="text" name="customerName" required>
<label>Email</label><input type="email" name="customerEmail" required>
<label>Phone</label><input type="text" name="customerPhone" required>
<button type="submit">Checkout</button>
<p id="status"></p>
</form>
</div>

<script>
const APP_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_APP_SCRIPT_ID/exec";

let products = [
  {id:"p1", name:"Vitamin C", price:12.5, image:""},
  {id:"p2", name:"Omega 3", price:20, image:""},
  {id:"p3", name:"Protein Powder", price:35, image:""}
];

let cart = JSON.parse(localStorage.getItem("site_cart_v1")) || [];

function renderProducts() {
  const container = document.getElementById("product-list");
  container.innerHTML = products.map(p=>`
    <div class="product">
      ${p.image?`<img src="${p.image}" alt="${p.name}">`:""}
      <h3>${p.name}</h3>
      <p>$${p.price.toFixed(2)}</p>
      <div class="qty-box">
        <label>Qty:</label>
        <input type="number" min="1" value="1" id="qty-${p.id}">
      </div>
      <button onclick="addToCart('${p.id}')">Add to Cart</button>
    </div>
  `).join("");
}

function addToCart(id){
  const product = products.find(p=>p.id===id);
  const qtyInput = document.getElementById(`qty-${id}`);
  let qty = parseInt(qtyInput.value)||1;
  const existing = cart.find(i=>i.id===id);
  if(existing) existing.qty += qty;
  else cart.push({...product, qty});
  saveCart();
}

function saveCart(){
  localStorage.setItem("site_cart_v1", JSON.stringify(cart));
  renderCart();
  updateCartCount();
}

function updateCartCount(){
  const count = cart.reduce((s,i)=>s+(i.qty||0),0);
  document.getElementById("cart-count").textContent=count;
}

function cartSubtotal(){
  return cart.reduce((s,i)=>s+(i.price||0)*(i.qty||0),0);
}

function renderCart(){
  const el = document.getElementById("cart-items");
  if(cart.length===0){ el.innerHTML="<p>Your cart is empty.</p>"; document.getElementById("cart-subtotal").textContent="0.00"; return; }
  el.innerHTML = cart.map(item=>`
    <div class="cart-item">
      ${item.image?`<img src="${item.image}" alt="${item.name}">`:""}
      <div>
        <h4>${item.name}</h4>
        <p>$${item.price.toFixed(2)}</p>
      </div>
      <div class="actions">
        <input type="number" min="1" value="${item.qty}" data-id="${item.id}" class="qty-input">
        <button class="remove-item" data-id="${item.id}">Remove</button>
      </div>
    </div>
  `).join("");
  document.getElementById("cart-subtotal").textContent=cartSubtotal().toFixed(2);

  document.querySelectorAll(".qty-input").forEach(input=>{
    input.addEventListener("change", e=>{
      const id = e.currentTarget.dataset.id;
      const qty = Math.max(1, parseInt(e.currentTarget.value)||1);
      const item = cart.find(i=>i.id===id);
      if(item) item.qty=qty;
      saveCart();
    });
  });

  document.querySelectorAll(".remove-item").forEach(btn=>{
    btn.addEventListener("click", e=>{
      const id = e.currentTarget.dataset.id;
      cart = cart.filter(i=>i.id!==id);
      saveCart();
    });
  });
}

document.getElementById("cart-btn").addEventListener("click", ()=>document.getElementById("cart-panel").classList.add("open"));
document.getElementById("close-cart").addEventListener("click", ()=>document.getElementById("cart-panel").classList.remove("open"));

document.getElementById("checkoutForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  document.getElementById("status").textContent="Submitting...";
  document.getElementById("cartData").value = JSON.stringify(cart);

  const formData = {
    customerName: e.target.customerName.value,
    customerEmail: e.target.customerEmail.value,
    customerPhone: e.target.customerPhone.value,
    cartData: cart
  };

  try{
    const res = await fetch(APP_SCRIPT_URL,{
      method:"POST",
      body: JSON.stringify(formData)
    });
    if(res.ok){
      document.getElementById("status").textContent="Order submitted successfully!";
      cart = [];
      saveCart();
    } else{
      document.getElementById("status").textContent="Error submitting order.";
    }
  } catch(err){
    document.getElementById("status").textContent="Error submitting order.";
    console.error(err);
  }
});

renderProducts();
renderCart();
updateCartCount();
</script>
</body>
</html>
